<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: api.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: api.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { httpGet } from './http.js'

const apiEndpoint = 'https://thomas-veillard.fr/wp-content/uploads/'

/**
 * A stock ticker from GAFAM, which is a kind of ID for the trading market.
 * Amazon (AMZN) has been excluded because of the lack of data in original API response.
 * @typedef {"AAPL" | "FB" | "GOOG" | "MSFT"} Ticker
 */

/**
 * Root response object describing a stock and it's 5-years rate history,
 * as returned by the API.
 * @typedef {Object} RawRateHistoryResponse
 * @property {Object} data
 * @property {Ticker} data.symbol - The stock ticker.
 * @property {string} data.company - The company name.
 * @property {string} data.timeAsOf - Date of the data compilation.
 * @property {Object[]} data.chart - The rate history itself.
 * @property {RawRateRange} data.chart[].z
 */

/**
 * Summarize the rate changes during a day, as returned from the API.
 * @typedef {Object} RawRateRange
 * @property {string} high - Higher price of the day.
 * @property {string} low - Lower price of the day.
 * @property {string} open - Price of the stock at the market's opening hour.
 * @property {string} close - Price of the stock at the market's closing hour.
 * @property {string} volume - Count how many shares have been exchanged during the day.
 * @property {string} dateTime - The date, formatted as a string.
 */

/**
 * Unserialized root response object describing a stock and it's 5-years rate history.
 * Some fields, such dates and numbers, have been parsed from string.
 * @typedef {Object} RateHistoryResponse
 * @property {Ticker} symbol - The stock ticker.
 * @property {string} company - The company name.
 * @property {Date} timeAsOf - Date of the data compilation.
 * @property {Object[]} chart - The rate history itself.
 * @property {RateRange} chart[].z
 */

/**
 * Summarize the rate changes during a day, as returned from the API.
 * @typedef {Object} RateRange
 * @property {number} high - Higher price of the day.
 * @property {number} low - Lower price of the day.
 * @property {number} open - Price of the stock at the market's opening hour.
 * @property {number} close - Price of the stock at the market's closing hour.
 * @property {number} volume - Count how many shares have been exchanged during the day.
 * @property {Date} dateTime - The date, formatted as a string.
 */

/**
 * Returns the rate history of a ticker for last 5 years.
 * @param {Ticker} ticker - Ticker of the stock to fetch.
 * @returns {Promise&lt;RateHistoryResponse>}
 */
export async function apiGetRateHistory (ticker) {
  /** @type {RawRateHistoryResponse['data']} */
  const rawResponse = (await httpGet(`${apiEndpoint}5y-rates/${ticker}-rates-5y.json`)).data

  return {
    company: rawResponse.company,
    symbol: rawResponse.symbol,
    timeAsOf: new Date(rawResponse.timeAsOf),
    chart: rawResponse.chart.map(({ z }) => ({
      z: {
        high: parseFloat(z.high),
        low: parseFloat(z.low),
        open: parseFloat(z.open),
        close: parseFloat(z.close),
        volume: parseInt(z.volume.replace(/,/g, ''), 10),
        dateTime: new Date(z.dateTime)
      }
    }))
  }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#apiGetRateHistory">apiGetRateHistory</a></li><li><a href="global.html#createNodeWithText">createNodeWithText</a></li><li><a href="global.html#formatPriceUSD">formatPriceUSD</a></li><li><a href="global.html#httpCheckCodeAndParseJson">httpCheckCodeAndParseJson</a></li><li><a href="global.html#httpGet">httpGet</a></li><li><a href="global.html#renderRates">renderRates</a></li><li><a href="global.html#renderTableHeader">renderTableHeader</a></li><li><a href="global.html#siteName">siteName</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.11</a> on Thu Sep 15 2022 18:56:55 GMT+0200 (heure d’été d’Europe centrale)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
